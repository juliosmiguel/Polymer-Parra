<link rel="import" href="/bower_components/polymer/polymer-element.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/iron-form/iron-form.html">
<link rel="import" href="../core/styles/jp-styles.html">
<link rel="import" href="../users/jp-app-user-store.html">

<dom-module id="jp-app-login">
    <template>
        <style include="jp-styles">
        
        </style>
        <jp-app-user-store id="userStore"></jp-app-user-store>
        <form id="formLogin" method="get" action="/#/home">                
            <paper-input label="Usuario" id="idUsuarioJp" maxlength="10" minlength="8"></paper-input>
            <paper-input label="Password" type="password" id="passwordJp" maxlength="10" minlength="6"></paper-input>
            <paper-button raised on-click="_login">Login</paper-button>
        </form>
    </template>
    <script>
        class JpAppLogin extends Polymer.Element {
            static get is(){ return 'jp-app-login';}
            static get properties(){
                return {
                    urlLogin: {
                        type:String,
                        value: 'login'
                    },
                    data: Object
                };
            }
            ready(){
                super.ready();
                addEventListener("jp-user-store-response", this._onResponse.bind(this));
                addEventListener("jp-user-store-error", this._onError.bind(this));
                
            }

            _onPreSubmit(){
                this.$.form.request.body = new FormData();
            }

            _login(){
                console.log('_login');
                this.$.userStore.generateRequest();
            }
            _onResponse(){
                this.$.formLogin.submit();
            }

            _onError(){
                console.log("errorLogin");
                alert("Datos introducidos erroneos");
            }
        }

        window.customElements.define(JpAppLogin.is, JpAppLogin);
    </script>
</dom-module>